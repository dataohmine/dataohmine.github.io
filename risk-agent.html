<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Risk Management Suite - Multi-Agent Financial Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#7C3AED',
                        secondary: '#6D28D9',
                        accent: '#A855F7'
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 text-gray-900 font-sans">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-purple-600 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-chart-line text-white text-lg"></i>
                        </div>
                        <span class="text-xl font-semibold text-gray-900">Risk Management Suite</span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="mailto:john.mfe@gmail.com" class="text-gray-600 hover:text-primary transition duration-200 hidden sm:inline-flex items-center">
                        <i class="fas fa-envelope mr-2"></i>Contact
                    </a>
                    <a href="index.html" class="text-gray-600 hover:text-primary transition duration-200">‚Üê Back to Portfolio</a>
                    <button id="refreshBtn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary transition duration-200 text-sm">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh Data
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Alert Banner -->
    <div id="riskAlert" class="bg-red-600 text-white py-2 px-4 hidden">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center">
                <i class="fas fa-exclamation-triangle mr-2"></i>
                <span id="alertText">High risk detected in portfolio!</span>
            </div>
            <button onclick="document.getElementById('riskAlert').classList.add('hidden')" class="text-white hover:text-gray-200">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-4">Multi-Agent Risk Management System</h1>
            <p class="text-xl text-gray-600">AI-powered portfolio monitoring with real-time risk assessment and automated alerts</p>
        </div>

        <!-- Key Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Portfolio Value</p>
                        <p id="portfolioValue" class="text-2xl font-bold text-gray-900">$2,450,000</p>
                    </div>
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-wallet text-green-600 text-xl"></i>
                    </div>
                </div>
                <div class="flex items-center mt-2">
                    <span id="portfolioChange" class="text-sm text-green-600">+5.2% this month</span>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Risk Score</p>
                        <p id="riskScore" class="text-2xl font-bold text-orange-600">7.3</p>
                    </div>
                    <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-exclamation-triangle text-orange-600 text-xl"></i>
                    </div>
                </div>
                <div class="flex items-center mt-2">
                    <span id="riskTrend" class="text-sm text-orange-600">Moderate Risk</span>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Active Positions</p>
                        <p id="activePositions" class="text-2xl font-bold text-gray-900">24</p>
                    </div>
                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-coins text-blue-600 text-xl"></i>
                    </div>
                </div>
                <div class="flex items-center mt-2">
                    <span id="positionChange" class="text-sm text-blue-600">3 new positions</span>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Alerts Today</p>
                        <p id="alertsCount" class="text-2xl font-bold text-red-600">7</p>
                    </div>
                    <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-bell text-red-600 text-xl"></i>
                    </div>
                </div>
                <div class="flex items-center mt-2">
                    <span id="alertStatus" class="text-sm text-red-600">2 critical</span>
                </div>
            </div>
        </div>

        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Portfolio Risk Analysis -->
            <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold text-gray-900">Portfolio Risk Analysis</h2>
                    <div class="flex space-x-2">
                        <button class="px-3 py-1 bg-primary text-white rounded text-sm">7D</button>
                        <button class="px-3 py-1 bg-gray-200 text-gray-700 rounded text-sm">30D</button>
                        <button class="px-3 py-1 bg-gray-200 text-gray-700 rounded text-sm">90D</button>
                    </div>
                </div>
                <div class="relative">
                    <canvas id="riskChart" width="800" height="300"></canvas>
                </div>
            </div>

            <!-- AI Agent Status -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-6">AI Agent Status</h2>
                
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                            <div>
                                <p class="font-medium text-gray-900">Risk Monitor Agent</p>
                                <p class="text-sm text-gray-600">Portfolio scanning</p>
                            </div>
                        </div>
                        <span class="text-xs text-green-600 bg-green-100 px-2 py-1 rounded">Active</span>
                    </div>

                    <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-blue-500 rounded-full mr-3"></div>
                            <div>
                                <p class="font-medium text-gray-900">Market Analysis Agent</p>
                                <p class="text-sm text-gray-600">Processing trends</p>
                            </div>
                        </div>
                        <span class="text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded">Working</span>
                    </div>

                    <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-yellow-500 rounded-full mr-3"></div>
                            <div>
                                <p class="font-medium text-gray-900">Alert Manager Agent</p>
                                <p class="text-sm text-gray-600">7 pending alerts</p>
                            </div>
                        </div>
                        <span class="text-xs text-yellow-600 bg-yellow-100 px-2 py-1 rounded">Busy</span>
                    </div>

                    <div class="flex items-center justify-between p-3 bg-purple-50 rounded-lg">
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-purple-500 rounded-full mr-3"></div>
                            <div>
                                <p class="font-medium text-gray-900">Strategy Agent</p>
                                <p class="text-sm text-gray-600">Optimizing allocation</p>
                            </div>
                        </div>
                        <span class="text-xs text-purple-600 bg-purple-100 px-2 py-1 rounded">Active</span>
                    </div>
                </div>

                <!-- Agent Performance -->
                <div class="mt-6 pt-4 border-t border-gray-200">
                    <h3 class="text-sm font-medium text-gray-900 mb-3">Agent Performance Today</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Alerts Generated</span>
                            <span class="font-medium">23</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Risks Identified</span>
                            <span class="font-medium">7</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Actions Taken</span>
                            <span class="font-medium">12</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Risk Alerts & Recommendations -->
        <div class="mt-8 grid lg:grid-cols-2 gap-8">
            <!-- Active Risk Alerts -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-6">Active Risk Alerts</h2>
                
                <div class="space-y-4">
                    <div class="flex items-start p-4 bg-red-50 border-l-4 border-red-400 rounded-lg">
                        <i class="fas fa-exclamation-circle text-red-600 text-lg mr-3 mt-1"></i>
                        <div class="flex-1">
                            <h4 class="font-semibold text-red-900">Critical: BTC Position Overweight</h4>
                            <p class="text-red-800 text-sm mt-1">Bitcoin position exceeds 25% portfolio allocation threshold. Consider rebalancing.</p>
                            <div class="flex items-center mt-2">
                                <span class="text-xs text-red-600">2 minutes ago</span>
                                <button class="ml-auto px-3 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded text-xs transition">
                                    Action Required
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-start p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-lg">
                        <i class="fas fa-exclamation-triangle text-yellow-600 text-lg mr-3 mt-1"></i>
                        <div class="flex-1">
                            <h4 class="font-semibold text-yellow-900">Warning: High Correlation Detected</h4>
                            <p class="text-yellow-800 text-sm mt-1">ETH and ADA showing 0.89 correlation over 7 days. Diversification at risk.</p>
                            <div class="flex items-center mt-2">
                                <span class="text-xs text-yellow-600">15 minutes ago</span>
                                <button class="ml-auto px-3 py-1 bg-yellow-100 hover:bg-yellow-200 text-yellow-700 rounded text-xs transition">
                                    Review
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-start p-4 bg-orange-50 border-l-4 border-orange-400 rounded-lg">
                        <i class="fas fa-chart-line text-orange-600 text-lg mr-3 mt-1"></i>
                        <div class="flex-1">
                            <h4 class="font-semibold text-orange-900">Market: Volatility Spike</h4>
                            <p class="text-orange-800 text-sm mt-1">Market volatility increased 34% in last 4 hours. Consider protective measures.</p>
                            <div class="flex items-center mt-2">
                                <span class="text-xs text-orange-600">1 hour ago</span>
                                <button class="ml-auto px-3 py-1 bg-orange-100 hover:bg-orange-200 text-orange-700 rounded text-xs transition">
                                    Monitor
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Recommendations -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center mb-6">
                    <i class="fas fa-robot text-primary text-xl mr-3"></i>
                    <h2 class="text-xl font-semibold text-gray-900">AI Recommendations</h2>
                </div>
                
                <div class="space-y-6">
                    <div class="p-4 bg-blue-50 rounded-lg">
                        <h4 class="font-semibold text-blue-900 mb-2">Portfolio Rebalancing</h4>
                        <p class="text-blue-800 text-sm mb-3">Based on current market conditions and risk parameters, consider the following adjustments:</p>
                        <ul class="text-blue-800 text-sm space-y-1">
                            <li>‚Ä¢ Reduce BTC allocation from 32% to 25%</li>
                            <li>‚Ä¢ Increase stable coin exposure to 15%</li>
                            <li>‚Ä¢ Add defensive positions in low-beta assets</li>
                        </ul>
                        <div class="mt-3">
                            <span class="text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded">Confidence: 87%</span>
                        </div>
                    </div>

                    <div class="p-4 bg-green-50 rounded-lg">
                        <h4 class="font-semibold text-green-900 mb-2">Opportunity Alert</h4>
                        <p class="text-green-800 text-sm mb-3">Market analysis suggests potential entry points:</p>
                        <ul class="text-green-800 text-sm space-y-1">
                            <li>‚Ä¢ SOL showing oversold conditions (-15% from MA)</li>
                            <li>‚Ä¢ MATIC breaking above resistance levels</li>
                            <li>‚Ä¢ DeFi sector showing institutional accumulation</li>
                        </ul>
                        <div class="mt-3">
                            <span class="text-xs text-green-600 bg-green-100 px-2 py-1 rounded">Risk-Adjusted</span>
                        </div>
                    </div>

                    <div class="p-4 bg-purple-50 rounded-lg">
                        <h4 class="font-semibold text-purple-900 mb-2">Risk Optimization</h4>
                        <p class="text-purple-800 text-sm mb-3">Strategy suggestions to improve risk-adjusted returns:</p>
                        <ul class="text-purple-800 text-sm space-y-1">
                            <li>‚Ä¢ Implement stop-loss orders at -8% levels</li>
                            <li>‚Ä¢ Consider VIX hedging for downside protection</li>
                            <li>‚Ä¢ Increase position sizing discipline</li>
                        </ul>
                        <div class="mt-3">
                            <span class="text-xs text-purple-600 bg-purple-100 px-2 py-1 rounded">Automated Available</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Market Sentiment Analysis -->
        <div class="mt-8 bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center">
                    <i class="fas fa-chart-pie text-primary text-xl mr-3"></i>
                    <h2 class="text-xl font-semibold text-gray-900">Market Sentiment Analysis</h2>
                </div>
                <div class="flex items-center space-x-2 text-sm text-gray-500">
                    <i class="fas fa-clock mr-1"></i>
                    <span>Updated 2 minutes ago</span>
                </div>
            </div>

            <div class="grid lg:grid-cols-3 gap-6 mb-6">
                <!-- Overall Market Sentiment -->
                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Overall Market</h3>
                    <div class="flex items-center justify-center mb-4">
                        <div class="w-20 h-20 bg-blue-500 rounded-full flex items-center justify-center">
                            <span class="text-white text-lg font-bold" id="overallSentiment">72</span>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="text-blue-600 font-semibold mb-2" id="sentimentLabel">Bullish</div>
                        <div class="text-sm text-gray-600">Fear & Greed Index</div>
                    </div>
                </div>

                <!-- Social Sentiment -->
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Social Media</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Twitter</span>
                            <div class="flex items-center">
                                <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                    <div class="bg-green-500 h-2 rounded-full" style="width: 68%"></div>
                                </div>
                                <span class="text-sm font-medium">68%</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Reddit</span>
                            <div class="flex items-center">
                                <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                    <div class="bg-yellow-500 h-2 rounded-full" style="width: 45%"></div>
                                </div>
                                <span class="text-sm font-medium">45%</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">News</span>
                            <div class="flex items-center">
                                <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                    <div class="bg-green-500 h-2 rounded-full" style="width: 76%"></div>
                                </div>
                                <span class="text-sm font-medium">76%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Technical Indicators -->
                <div class="bg-gradient-to-br from-purple-50 to-violet-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Technical Signals</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">RSI</span>
                            <span class="text-sm font-medium text-yellow-600">58 (Neutral)</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">MACD</span>
                            <span class="text-sm font-medium text-green-600">Bullish</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Moving Avg</span>
                            <span class="text-sm font-medium text-green-600">Above 200MA</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Volume</span>
                            <span class="text-sm font-medium text-red-600">Below Avg</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sentiment Timeline -->
            <div class="bg-gray-50 rounded-lg p-4">
                <h4 class="text-sm font-semibold text-gray-900 mb-3">24h Sentiment Timeline</h4>
                <div class="relative">
                    <canvas id="sentimentChart" width="400" height="100"></canvas>
                </div>
            </div>
        </div>

        <!-- AI Risk Chat Assistant -->
        <div class="mt-8 bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="flex items-center mb-6">
                <i class="fas fa-comments text-primary text-xl mr-3"></i>
                <h2 class="text-xl font-semibold text-gray-900">AI Risk Assistant</h2>
                <div class="ml-auto">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                        <span class="w-2 h-2 bg-green-400 rounded-full mr-1"></span>
                        Online
                    </span>
                </div>
            </div>
            
            <div id="chatContainer" class="bg-gray-50 rounded-lg p-4 h-80 overflow-y-auto mb-4 space-y-3">
                <div class="flex items-start space-x-2">
                    <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-robot text-white text-sm"></i>
                    </div>
                    <div class="bg-white p-3 rounded-lg shadow-sm max-w-xs">
                        <p class="text-sm text-gray-800">Hello! I'm your AI Risk Assistant. I can help you analyze market conditions, assess portfolio risks, and provide actionable recommendations. What would you like to know?</p>
                    </div>
                </div>
            </div>
            
            <div class="flex space-x-2">
                <input 
                    type="text" 
                    id="chatInput" 
                    placeholder="Ask about risks, market analysis, or trading strategies..."
                    class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                    onkeypress="handleChatKeyPress(event)"
                >
                <button 
                    onclick="sendChatMessage()" 
                    class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-secondary transition duration-300"
                >
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            
            <div class="mt-4">
                <p class="text-xs text-gray-500 mb-2">Quick questions:</p>
                <div class="flex flex-wrap gap-2">
                    <button onclick="askQuickQuestion('What is my current portfolio risk?')" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded-full transition">
                        What is my portfolio risk?
                    </button>
                    <button onclick="askQuickQuestion('Should I rebalance now?')" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded-full transition">
                        Should I rebalance?
                    </button>
                    <button onclick="askQuickQuestion('Market sentiment analysis')" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded-full transition">
                        Market sentiment
                    </button>
                    <button onclick="askQuickQuestion('Recommend defensive strategies')" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded-full transition">
                        Defensive strategies
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simulated risk data
        let riskData = {
            portfolioValue: 2450000,
            riskScore: 7.3,
            activePositions: 24,
            alertsCount: 7
        };

        // Initialize dashboard
        function initializeDashboard() {
            updateMetrics();
            createRiskChart();
            
            // Show risk alert if score is high
            if (riskData.riskScore >= 7) {
                showRiskAlert();
            }
        }

        // Update key metrics
        function updateMetrics() {
            document.getElementById('portfolioValue').textContent = `$${(riskData.portfolioValue).toLocaleString()}`;
            document.getElementById('riskScore').textContent = riskData.riskScore.toFixed(1);
            document.getElementById('activePositions').textContent = riskData.activePositions;
            document.getElementById('alertsCount').textContent = riskData.alertsCount;
            
            // Update risk score color based on level
            const riskElement = document.getElementById('riskScore');
            if (riskData.riskScore >= 8) {
                riskElement.className = 'text-2xl font-bold text-red-600';
                document.getElementById('riskTrend').textContent = 'High Risk';
                document.getElementById('riskTrend').className = 'text-sm text-red-600';
            } else if (riskData.riskScore >= 6) {
                riskElement.className = 'text-2xl font-bold text-orange-600';
                document.getElementById('riskTrend').textContent = 'Moderate Risk';
                document.getElementById('riskTrend').className = 'text-sm text-orange-600';
            } else {
                riskElement.className = 'text-2xl font-bold text-green-600';
                document.getElementById('riskTrend').textContent = 'Low Risk';
                document.getElementById('riskTrend').className = 'text-sm text-green-600';
            }
        }

        // Create risk trend chart
        function createRiskChart() {
            const ctx = document.getElementById('riskChart').getContext('2d');
            
            // Generate sample historical data
            const labels = [];
            const riskScores = [];
            const portfolioValues = [];
            const today = new Date();
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                
                // Simulate risk scores trending toward current value
                const baseRisk = 5 + Math.random() * 2;
                const trendRisk = baseRisk + (riskData.riskScore - baseRisk) * (6 - i) / 6;
                riskScores.push(trendRisk + (Math.random() - 0.5) * 0.5);
                
                // Simulate portfolio values
                const baseValue = 2300000 + Math.random() * 200000;
                portfolioValues.push(baseValue + (riskData.portfolioValue - baseValue) * (6 - i) / 6);
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Risk Score',
                        data: riskScores,
                        borderColor: '#7C3AED',
                        backgroundColor: 'rgba(124, 58, 237, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        yAxisID: 'y'
                    }, {
                        label: 'Portfolio Value ($M)',
                        data: portfolioValues.map(v => v / 1000000),
                        borderColor: '#059669',
                        backgroundColor: 'rgba(5, 150, 105, 0.1)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.4,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            max: 10,
                            title: {
                                display: true,
                                text: 'Risk Score'
                            },
                            grid: {
                                color: '#e5e7eb'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Portfolio Value ($M)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        },
                        x: {
                            grid: {
                                color: '#e5e7eb'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }

        // Show risk alert
        function showRiskAlert() {
            const alertBanner = document.getElementById('riskAlert');
            const alertText = document.getElementById('alertText');
            
            if (riskData.riskScore >= 8) {
                alertText.textContent = 'Critical risk level detected! Immediate action recommended.';
                alertBanner.classList.remove('hidden');
            } else if (riskData.riskScore >= 7) {
                alertText.textContent = 'Elevated risk detected in portfolio. Review recommendations.';
                alertBanner.classList.remove('hidden');
            }
        }

        // Refresh data simulation
        function refreshData() {
            // Simulate new data
            riskData.portfolioValue += (Math.random() - 0.5) * 100000;
            riskData.riskScore += (Math.random() - 0.5) * 1;
            riskData.riskScore = Math.max(1, Math.min(10, riskData.riskScore)); // Keep in bounds
            riskData.activePositions += Math.floor((Math.random() - 0.5) * 3);
            riskData.alertsCount = Math.floor(Math.random() * 10) + 3;

            // Update display
            updateMetrics();
            
            // Show refresh animation
            const button = document.getElementById('refreshBtn');
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Refreshing...';
            
            setTimeout(() => {
                button.innerHTML = '<i class="fas fa-sync-alt mr-2"></i>Refresh Data';
            }, 1000);
        }

        // Event listeners
        document.getElementById('refreshBtn').addEventListener('click', refreshData);

        // Initialize sentiment chart
        function createSentimentChart() {
            const ctx = document.getElementById('sentimentChart').getContext('2d');
            const hours = [];
            const sentimentValues = [];
            
            // Generate 24 hours of sentiment data
            for (let i = 23; i >= 0; i--) {
                const hour = new Date(Date.now() - i * 60 * 60 * 1000);
                hours.push(hour.getHours() + ':00');
                sentimentValues.push(Math.random() * 40 + 40); // 40-80 range
            }
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hours,
                    datasets: [{
                        label: 'Sentiment Score',
                        data: sentimentValues,
                        borderColor: '#7C3AED',
                        backgroundColor: 'rgba(124, 58, 237, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            display: false
                        },
                        x: {
                            display: false
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Update sentiment data
        function updateSentimentData() {
            const sentiment = Math.floor(Math.random() * 30) + 50; // 50-80 range
            document.getElementById('overallSentiment').textContent = sentiment;
            
            let label = 'Neutral';
            if (sentiment >= 70) label = 'Bullish';
            else if (sentiment <= 40) label = 'Bearish';
            
            document.getElementById('sentimentLabel').textContent = label;
            document.getElementById('sentimentLabel').className = 
                sentiment >= 70 ? 'text-green-600 font-semibold mb-2' :
                sentiment <= 40 ? 'text-red-600 font-semibold mb-2' :
                'text-yellow-600 font-semibold mb-2';
        }

        // Chat functionality
        let chatHistory = [];

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            addChatMessage(message, 'user');
            input.value = '';

            // Show typing indicator
            showTypingIndicator();

            // Simulate AI response delay
            setTimeout(() => {
                hideTypingIndicator();
                const response = generateRiskResponse(message);
                addChatMessage(response, 'ai');
            }, 1500);
        }

        function askQuickQuestion(question) {
            document.getElementById('chatInput').value = question;
            sendChatMessage();
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        function addChatMessage(message, sender) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-start space-x-2';

            if (sender === 'ai') {
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-robot text-white text-sm"></i>
                    </div>
                    <div class="bg-white p-3 rounded-lg shadow-sm max-w-xs">
                        <p class="text-sm text-gray-800">${message}</p>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center flex-shrink-0 ml-auto">
                        <i class="fas fa-user text-white text-sm"></i>
                    </div>
                    <div class="bg-primary text-white p-3 rounded-lg shadow-sm ml-auto max-w-xs">
                        <p class="text-sm">${message}</p>
                    </div>
                `;
                messageDiv.className = 'flex items-start space-x-2 justify-end';
            }

            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function showTypingIndicator() {
            const chatContainer = document.getElementById('chatContainer');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.className = 'flex items-start space-x-2';
            typingDiv.innerHTML = `
                <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-robot text-white text-sm"></i>
                </div>
                <div class="bg-white p-3 rounded-lg shadow-sm">
                    <p class="text-sm text-gray-500">
                        <i class="fas fa-ellipsis-h animate-pulse"></i> AI is analyzing...
                    </p>
                </div>
            `;
            chatContainer.appendChild(typingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function generateRiskResponse(userMessage) {
            const message = userMessage.toLowerCase();
            
            if (message.includes('portfolio risk') || message.includes('current risk')) {
                return `Your current portfolio risk score is ${riskData.riskScore}/10. This indicates ${riskData.riskScore > 7 ? 'elevated risk due to high volatility and concentration in crypto assets' : 'moderate risk with balanced exposure'}. I recommend monitoring your BTC allocation which is currently at 32%.`;
            } else if (message.includes('rebalance') || message.includes('rebalancing')) {
                return `Based on current market conditions and your risk profile, yes - rebalancing is recommended. Reduce BTC from 32% to 25%, increase stablecoin exposure to 15%, and consider adding defensive positions. This would lower your risk score to approximately 6.2.`;
            } else if (message.includes('sentiment') || message.includes('market')) {
                const sentiment = document.getElementById('overallSentiment').textContent;
                return `Current market sentiment is at ${sentiment}/100 (${document.getElementById('sentimentLabel').textContent}). Social media sentiment is mixed with Twitter at 68% positive, Reddit at 45%, and news sentiment at 76%. Technical indicators show RSI at 58 (neutral) with MACD signaling bullish momentum.`;
            } else if (message.includes('defensive') || message.includes('strategy')) {
                return `Defensive strategies for current conditions: 1) Implement stop-losses at -8% levels, 2) Increase cash/stablecoin allocation to 15-20%, 3) Consider VIX hedging, 4) Reduce position sizes in high-beta assets, 5) Focus on assets with low correlation to overall market. Would you like specific recommendations for any of these?`;
            } else if (message.includes('btc') || message.includes('bitcoin')) {
                return `Bitcoin analysis: Currently overweight at 32% allocation. BTC is showing strong correlation with traditional markets (0.68 with S&P 500). Recent volatility spike of 34% in 4 hours suggests reducing exposure. Target allocation should be 25% or lower given current market conditions.`;
            } else if (message.includes('eth') || message.includes('ethereum')) {
                return `Ethereum is showing 0.89 correlation with ADA over 7 days, indicating reduced diversification benefit. ETH fundamentals remain strong with upcoming updates, but consider reducing correlated alt-coin exposure. Current technical setup suggests support at $1,850 with resistance at $2,100.`;
            } else if (message.includes('alert') || message.includes('warning')) {
                return `Active alerts: 1) Critical - BTC overweight (32% > 25% threshold), 2) Warning - High correlation between ETH/ADA (0.89), 3) Market volatility spike (+34% in 4h). Immediate actions: Review position sizing, implement stop-losses, consider protective hedges.`;
            } else {
                return `I can help you with portfolio risk analysis, market sentiment insights, rebalancing recommendations, and defensive strategies. Current portfolio status: $${(riskData.portfolioValue/1000000).toFixed(2)}M value, ${riskData.riskScore}/10 risk score, ${riskData.activePositions} active positions. What specific aspect would you like to explore?`;
            }
        }

        // Initialize dashboard on load
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            createSentimentChart();
            updateSentimentData();
        });

        // Auto-refresh every 30 seconds for demo
        setInterval(() => {
            refreshData();
        }, 30000);
    </script>
</body>
</html>